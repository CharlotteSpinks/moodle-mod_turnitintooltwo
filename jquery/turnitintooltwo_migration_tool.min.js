function dontmigrate(o){$("#migration_alert").hide(),o.close()}function lightBoxCloseButton(o){$("body").append('<div id="tii_close_bar"><a class="tii_close_link" href="#">'+M.str.turnitintooltwo.closebutton+"</a></div>")}function displayMigrationModal(){$("#migrate_type").data("turnitintoolid")!=$("#migrate_type").data("lastasked")&&($.colorbox({width:550,height:600,inline:!0,opacity:"0.7",href:"#migration_alert",onLoad:function(){$("#asktomigrate").show(),lightBoxCloseButton(),$(".tii_close_link").click($.proxy(dontmigrate,null,$.colorbox))},onCleanup:function(){$("#tii_close_bar").remove(),$("#migration_alert").hide()}}),$("#migration_alert").show()),2==$("#migrate_type").data("migratetype")&&($("#asktomigrate").hide(),$("#migrating").show(),migrate($("#migrate_type").data("courseid"),$("#migrate_type").data("turnitintoolid")))}function migrate(o,t){$.ajax({dataType:"json",type:"POST",url:M.cfg.wwwroot+"/mod/turnitintooltwo/ajax.php",data:{action:"begin_migration",courseid:o,turnitintoolid:t,sesskey:M.cfg.sesskey},success:function(o){switch($.colorbox&&$.colorbox.close(),$("#migration_alert").hide(),o.gradebook){case"gradebookerror":var t=3;break;case"cron":var t=2;break;default:var t=1}window.location.href=M.cfg.wwwroot+"/mod/turnitintooltwo/view.php?id="+o.id+"&migrated="+t},error:function(o){var t=o.responseJSON;$.colorbox&&$.colorbox.close(),$("#migration_alert").hide(),$("#turnitintool_style").prepend('<div id="full-error" class="box generalbox noticebox">'+t.error+" "+t.message+"</div>"),t.hasOwnProperty("trace")&&(console.error(t.message),console.error(JSON.stringify(t.trace,null,4)))}})}$(document).ready(function(){$.ajax({dataType:"json",type:"POST",url:M.cfg.wwwroot+"/mod/turnitintooltwo/ajax.php",data:{action:"check_migrated",turnitintoolid:$("#migrate_type").data("turnitintoolid"),sesskey:M.cfg.sesskey},success:function(o){o.migrated===!0?window.location.href=M.cfg.wwwroot+"/mod/turnitintooltwo/view.php?id="+o.v2id:(displayMigrationModal(),$(".dontmigrate_link").click($.proxy(dontmigrate,null,$.colorbox)))}})}),$(".migrate_link").on("click",function(){$("#asktomigrate").hide(),$("#migrating").show(),migrate($(this).data("courseid"),$(this).data("turnitintoolid"))});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInR1cm5pdGludG9vbHR3b19taWdyYXRpb25fdG9vbC5qcyJdLCJuYW1lcyI6WyJkb250bWlncmF0ZSIsImNiIiwiJCIsImhpZGUiLCJjbG9zZSIsImxpZ2h0Qm94Q2xvc2VCdXR0b24iLCJhcHBlbmQiLCJNIiwic3RyIiwidHVybml0aW50b29sdHdvIiwiY2xvc2VidXR0b24iLCJkaXNwbGF5TWlncmF0aW9uTW9kYWwiLCJkYXRhIiwiY29sb3Jib3giLCJ3aWR0aCIsImhlaWdodCIsImlubGluZSIsIm9wYWNpdHkiLCJocmVmIiwib25Mb2FkIiwic2hvdyIsImNsaWNrIiwicHJveHkiLCJvbkNsZWFudXAiLCJyZW1vdmUiLCJtaWdyYXRlIiwiY291cnNlaWQiLCJ0dXJuaXRpbnRvb2xpZCIsImFqYXgiLCJkYXRhVHlwZSIsInR5cGUiLCJ1cmwiLCJjZmciLCJ3d3dyb290IiwiYWN0aW9uIiwic2Vzc2tleSIsInN1Y2Nlc3MiLCJncmFkZWJvb2siLCJtaWdyYXRlZCIsIndpbmRvdyIsImxvY2F0aW9uIiwiaWQiLCJlcnJvciIsInJlc3BvbnNlSlNPTiIsInByZXBlbmQiLCJtZXNzYWdlIiwiaGFzT3duUHJvcGVydHkiLCJjb25zb2xlIiwiSlNPTiIsInN0cmluZ2lmeSIsInRyYWNlIiwiZG9jdW1lbnQiLCJyZWFkeSIsInYyaWQiLCJvbiIsInRoaXMiXSwibWFwcGluZ3MiOiJBQThCQSxRQUFTQSxhQUFZQyxHQUNqQkMsRUFBRSxvQkFBb0JDLE9BQ3RCRixFQUFHRyxRQUdQLFFBQVNDLHFCQUFvQkosR0FDekJDLEVBQUUsUUFBUUksT0FBTyw4REFBZ0VDLEVBQUVDLElBQUlDLGdCQUFnQkMsWUFBYyxjQUl6SCxRQUFTQyx5QkFFRFQsRUFBRSxpQkFBaUJVLEtBQUssbUJBQXFCVixFQUFFLGlCQUFpQlUsS0FBSyxlQUNyRVYsRUFBRVcsVUFBVUMsTUFBTyxJQUFLQyxPQUFRLElBQUtDLFFBQU8sRUFBTUMsUUFBUyxNQUFPQyxLQUFLLG1CQUNuRUMsT0FBUSxXQUNKakIsRUFBRSxpQkFBaUJrQixPQUNuQmYsc0JBRUFILEVBQUUsbUJBQW1CbUIsTUFBTW5CLEVBQUVvQixNQUFNdEIsWUFBYSxLQUFNRSxFQUFFVyxZQUU1RFUsVUFBVSxXQUNOckIsRUFBRSxrQkFBa0JzQixTQUNwQnRCLEVBQUUsb0JBQW9CQyxVQUk5QkQsRUFBRSxvQkFBb0JrQixRQUdvQixHQUExQ2xCLEVBQUUsaUJBQWlCVSxLQUFLLGlCQUN4QlYsRUFBRSxpQkFBaUJDLE9BQ25CRCxFQUFFLGNBQWNrQixPQUVoQkssUUFBUXZCLEVBQUUsaUJBQWlCVSxLQUFLLFlBQWFWLEVBQUUsaUJBQWlCVSxLQUFLLG9CQUk3RSxRQUFTYSxTQUFRQyxFQUFVQyxHQUN2QnpCLEVBQUUwQixNQUNFQyxTQUFZLE9BQ1pDLEtBQVEsT0FDUkMsSUFBS3hCLEVBQUV5QixJQUFJQyxRQUFVLGdDQUNyQnJCLE1BQVNzQixPQUFRLGtCQUFtQlIsU0FBVUEsRUFBVUMsZUFBZ0JBLEVBQWdCUSxRQUFTNUIsRUFBRXlCLElBQUlHLFNBQ3ZHQyxRQUFTLFNBQVN4QixHQU1kLE9BTElWLEVBQUVXLFVBQ0ZYLEVBQUVXLFNBQVNULFFBRWZGLEVBQUUsb0JBQW9CQyxPQUVkUyxFQUFLeUIsV0FDVCxJQUFLLGlCQUNELEdBQUlDLEdBQVcsQ0FDZixNQUNKLEtBQUssT0FDRCxHQUFJQSxHQUFXLENBQ2YsTUFDSixTQUNJLEdBQUlBLEdBQVcsRUFFdkJDLE9BQU9DLFNBQVN0QixLQUFPWCxFQUFFeUIsSUFBSUMsUUFBVSxvQ0FBb0NyQixFQUFLNkIsR0FBRyxhQUFhSCxHQUVwR0ksTUFBTyxTQUFTQSxHQUNaLEdBQUk5QixHQUFPOEIsRUFBTUMsWUFDYnpDLEdBQUVXLFVBQ0ZYLEVBQUVXLFNBQVNULFFBRWZGLEVBQUUsb0JBQW9CQyxPQUN0QkQsRUFBRSx1QkFDRzBDLFFBQVEseURBQTJEaEMsRUFBSzhCLE1BQVEsSUFBTTlCLEVBQUtpQyxRQUFVLFVBR3RHakMsRUFBS2tDLGVBQWUsV0FDcEJDLFFBQVFMLE1BQU05QixFQUFLaUMsU0FDbkJFLFFBQVFMLE1BQU1NLEtBQUtDLFVBQVVyQyxFQUFLc0MsTUFBTyxLQUFNLFFBdkcvRGhELEVBQUVpRCxVQUFVQyxNQUFNLFdBR2RsRCxFQUFFMEIsTUFDRUMsU0FBWSxPQUNaQyxLQUFRLE9BQ1JDLElBQU94QixFQUFFeUIsSUFBSUMsUUFBVSxnQ0FDdkJyQixNQUNJc0IsT0FBUSxpQkFDUlAsZUFBZ0J6QixFQUFFLGlCQUFpQlUsS0FBSyxrQkFDeEN1QixRQUFTNUIsRUFBRXlCLElBQUlHLFNBRW5CQyxRQUFXLFNBQVN4QixHQUNaQSxFQUFLMEIsWUFBYSxFQUNsQkMsT0FBT0MsU0FBU3RCLEtBQU9YLEVBQUV5QixJQUFJQyxRQUFVLG9DQUFvQ3JCLEVBQUt5QyxNQUVoRjFDLHdCQUVBVCxFQUFFLHFCQUFxQm1CLE1BQU1uQixFQUFFb0IsTUFBTXRCLFlBQWEsS0FBTUUsRUFBRVcsaUJBTTFFWCxFQUFFLGlCQUFpQm9ELEdBQUcsUUFBUyxXQUMzQnBELEVBQUUsaUJBQWlCQyxPQUNuQkQsRUFBRSxjQUFja0IsT0FDaEJLLFFBQVF2QixFQUFFcUQsTUFBTTNDLEtBQUssWUFBYVYsRUFBRXFELE1BQU0zQyxLQUFLIiwiZmlsZSI6InR1cm5pdGludG9vbHR3b19taWdyYXRpb25fdG9vbC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpe1xuXG4gICAgLy8gQ2hlY2sgd2hldGhlciB0aGlzIGFzc2lnbm1lbnQgaGFzIGJlZW4gbWlncmF0ZWQgaW4gdGhpcyBzZXNzaW9uIGFuZCByZWRpcmVjdCBpZiBzby5cbiAgICAkLmFqYXgoe1xuICAgICAgICBcImRhdGFUeXBlXCI6ICdqc29uJyxcbiAgICAgICAgXCJ0eXBlXCI6IFwiUE9TVFwiLFxuICAgICAgICBcInVybFwiOiBNLmNmZy53d3dyb290ICsgXCIvbW9kL3R1cm5pdGludG9vbHR3by9hamF4LnBocFwiLFxuICAgICAgICBcImRhdGFcIjoge1xuICAgICAgICAgICAgYWN0aW9uOiBcImNoZWNrX21pZ3JhdGVkXCIsXG4gICAgICAgICAgICB0dXJuaXRpbnRvb2xpZDogJChcIiNtaWdyYXRlX3R5cGVcIikuZGF0YShcInR1cm5pdGludG9vbGlkXCIpLFxuICAgICAgICAgICAgc2Vzc2tleTogTS5jZmcuc2Vzc2tleVxuICAgICAgICB9LFxuICAgICAgICBcInN1Y2Nlc3NcIjogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEubWlncmF0ZWQgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IE0uY2ZnLnd3d3Jvb3QgKyBcIi9tb2QvdHVybml0aW50b29sdHdvL3ZpZXcucGhwP2lkPVwiK2RhdGEudjJpZDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZGlzcGxheU1pZ3JhdGlvbk1vZGFsKCk7XG5cbiAgICAgICAgICAgICAgICAkKCcuZG9udG1pZ3JhdGVfbGluaycpLmNsaWNrKCQucHJveHkoZG9udG1pZ3JhdGUsIG51bGwsICQuY29sb3Jib3gpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufSk7XG5cbiQoJy5taWdyYXRlX2xpbmsnKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAkKCcjYXNrdG9taWdyYXRlJykuaGlkZSgpO1xuICAgICQoJyNtaWdyYXRpbmcnKS5zaG93KCk7XG4gICAgbWlncmF0ZSgkKHRoaXMpLmRhdGEoXCJjb3Vyc2VpZFwiKSwgJCh0aGlzKS5kYXRhKFwidHVybml0aW50b29saWRcIikpO1xufSk7XG5cbmZ1bmN0aW9uIGRvbnRtaWdyYXRlKGNiKSB7XG4gICAgJCgnI21pZ3JhdGlvbl9hbGVydCcpLmhpZGUoKTtcbiAgICBjYi5jbG9zZSgpO1xufVxuXG5mdW5jdGlvbiBsaWdodEJveENsb3NlQnV0dG9uKGNiKSB7XG4gICAgJCgnYm9keScpLmFwcGVuZCgnPGRpdiBpZD1cInRpaV9jbG9zZV9iYXJcIj48YSBjbGFzcz1cInRpaV9jbG9zZV9saW5rXCIgaHJlZj1cIiNcIj4nICsgTS5zdHIudHVybml0aW50b29sdHdvLmNsb3NlYnV0dG9uICsgJzwvYT48L2Rpdj4nKTtcbn1cblxuXG5mdW5jdGlvbiBkaXNwbGF5TWlncmF0aW9uTW9kYWwoKSB7XG4gICAgLy8gT25seSBkaXNwbGF5IHRoZSBtb2RhbCBkdXJpbmcgYSBtYW51YWwgbWlncmF0aW9uLlxuICAgIGlmICgkKCcjbWlncmF0ZV90eXBlJykuZGF0YShcInR1cm5pdGludG9vbGlkXCIpICE9ICQoXCIjbWlncmF0ZV90eXBlXCIpLmRhdGEoXCJsYXN0YXNrZWRcIikpIHtcbiAgICAgICAgJC5jb2xvcmJveCh7d2lkdGg6IDU1MCwgaGVpZ2h0OiA2MDAsIGlubGluZTp0cnVlLCBvcGFjaXR5OiBcIjAuN1wiLCBocmVmOlwiI21pZ3JhdGlvbl9hbGVydFwiLFxuICAgICAgICAgICAgb25Mb2FkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkKCcjYXNrdG9taWdyYXRlJykuc2hvdygpO1xuICAgICAgICAgICAgICAgIGxpZ2h0Qm94Q2xvc2VCdXR0b24oKTtcblxuICAgICAgICAgICAgICAgICQoJy50aWlfY2xvc2VfbGluaycpLmNsaWNrKCQucHJveHkoZG9udG1pZ3JhdGUsIG51bGwsICQuY29sb3Jib3gpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbkNsZWFudXA6ZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJCgnI3RpaV9jbG9zZV9iYXInKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkKCcjbWlncmF0aW9uX2FsZXJ0JykuaGlkZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkKCcjbWlncmF0aW9uX2FsZXJ0Jykuc2hvdygpO1xuICAgIH1cblxuICAgIGlmICgkKCcjbWlncmF0ZV90eXBlJykuZGF0YShcIm1pZ3JhdGV0eXBlXCIpID09IDIpIHtcbiAgICAgICAgJCgnI2Fza3RvbWlncmF0ZScpLmhpZGUoKTtcbiAgICAgICAgJCgnI21pZ3JhdGluZycpLnNob3coKTtcblxuICAgICAgICBtaWdyYXRlKCQoXCIjbWlncmF0ZV90eXBlXCIpLmRhdGEoXCJjb3Vyc2VpZFwiKSwgJChcIiNtaWdyYXRlX3R5cGVcIikuZGF0YShcInR1cm5pdGludG9vbGlkXCIpKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIG1pZ3JhdGUoY291cnNlaWQsIHR1cm5pdGludG9vbGlkKSB7XG4gICAgJC5hamF4KHtcbiAgICAgICAgXCJkYXRhVHlwZVwiOiAnanNvbicsXG4gICAgICAgIFwidHlwZVwiOiBcIlBPU1RcIixcbiAgICAgICAgdXJsOiBNLmNmZy53d3dyb290ICsgXCIvbW9kL3R1cm5pdGludG9vbHR3by9hamF4LnBocFwiLFxuICAgICAgICBcImRhdGFcIjoge2FjdGlvbjogXCJiZWdpbl9taWdyYXRpb25cIiwgY291cnNlaWQ6IGNvdXJzZWlkLCB0dXJuaXRpbnRvb2xpZDogdHVybml0aW50b29saWQsIHNlc3NrZXk6IE0uY2ZnLnNlc3NrZXl9LFxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICBpZiAoJC5jb2xvcmJveCkge1xuICAgICAgICAgICAgICAgICQuY29sb3Jib3guY2xvc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICQoJyNtaWdyYXRpb25fYWxlcnQnKS5oaWRlKCk7XG5cbiAgICAgICAgICAgIHN3aXRjaCAoZGF0YS5ncmFkZWJvb2spIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiZ3JhZGVib29rZXJyb3JcIjpcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1pZ3JhdGVkID0gMztcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImNyb25cIjpcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1pZ3JhdGVkID0gMjtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1pZ3JhdGVkID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gTS5jZmcud3d3cm9vdCArIFwiL21vZC90dXJuaXRpbnRvb2x0d28vdmlldy5waHA/aWQ9XCIrZGF0YS5pZCtcIiZtaWdyYXRlZD1cIittaWdyYXRlZDtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgICAgICB2YXIgZGF0YSA9IGVycm9yLnJlc3BvbnNlSlNPTjtcbiAgICAgICAgICAgIGlmICgkLmNvbG9yYm94KSB7XG4gICAgICAgICAgICAgICAgJC5jb2xvcmJveC5jbG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJCgnI21pZ3JhdGlvbl9hbGVydCcpLmhpZGUoKTtcbiAgICAgICAgICAgICQoJyN0dXJuaXRpbnRvb2xfc3R5bGUnKVxuICAgICAgICAgICAgICAgIC5wcmVwZW5kKCc8ZGl2IGlkPVwiZnVsbC1lcnJvclwiIGNsYXNzPVwiYm94IGdlbmVyYWxib3ggbm90aWNlYm94XCI+JyArIGRhdGEuZXJyb3IgKyAnICcgKyBkYXRhLm1lc3NhZ2UgKyAnPC9kaXY+Jyk7XG5cbiAgICAgICAgICAgIC8vIENoZWNrIGlmIHdlIGhhdmUgYSBzdGFjayB0cmFjZSBpbmNsdWRlZC5cbiAgICAgICAgICAgIGlmIChkYXRhLmhhc093blByb3BlcnR5KCd0cmFjZScpKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihkYXRhLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoSlNPTi5zdHJpbmdpZnkoZGF0YS50cmFjZSwgbnVsbCwgNCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59XG4iXX0=
